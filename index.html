<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Copiar Retorno da API do Sienge</title>
</head>
<body>

  <h1>Copiar Retorno da API do Sienge</h1>

  <button id="copiarConteudo">Copiar Retorno da API</button>

  <div id="resultado"></div>

  <script>
    // Adicionando evento ao botão de copiar conteúdo
    document.getElementById('copiarConteudo').addEventListener('click', async function() {
      try {
        const billId = prompt('Por favor, insira o ID do título:');

        const urlIntermediario = `http://localhost:3000/api/bills/${billId}`;
        const response = await fetch(urlIntermediario, { mode: 'cors' });

        if (!response.ok) {
          throw new Error('Erro na chamada da API do Sienge via servidor intermediário: ' + response.status);
        }

        const data = response.body ? await response.json() : null;

        if (!data) {
          throw new Error('A resposta da API não possui um corpo JSON válido.');
        }

        console.log('Dados da API do Sienge (via servidor intermediário):', data);

        const resultadoElemento = document.getElementById('resultado');
        resultadoElemento.innerHTML = "<pre>" + JSON.stringify(data, null, 2) + "</pre>";

        // Copiando o conteúdo para a área de transferência
        const textarea = document.createElement('textarea');
        textarea.value = JSON.stringify(data, null, 2);
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);

        alert('Conteúdo copiado com sucesso!');

      } catch (error) {
        console.error('Erro na chamada da API do Sienge via servidor intermediário:', error);
      }
    });
  </script>

</body>
</html>
