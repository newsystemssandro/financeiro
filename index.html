<script>
  function buscarEEnviarParaAPIs() {
    var billId = document.getElementById('billId').value;
    buscarAPI(billId);
  }

  function buscarAPI(billId) {
    var urlSienge = 'https://api.sienge.com.br/ebm/public/api/v1/bills/' + billId;

    fetch(urlSienge)
      .then(response => {
        if (!response.ok) {
          throw new Error('Erro na chamada da API Sienge: ' + response.status);
        }
        return response.json();
      })
      .then(data => {
        exibirResultado(data);
        enviarParaMilvus(data);
      })
      .catch(error => {
        console.error('Erro na chamada da API Sienge:', error.message);
        exibirResultadoError('Erro ao chamar a API Sienge.');
      });
  }

  function exibirResultado(data) {
    var resultadoElemento = document.getElementById('resultado');
    resultadoElemento.innerHTML = "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
  }

  function exibirResultadoError(message) {
    var resultadoElemento = document.getElementById('resultado');
    resultadoElemento.innerHTML = "<p>" + message + "</p>";
  }

  // Enviar dados para Milvus usando fetch
      fetch('https://apiintegracao.milvus.com.br/api/chamado/criar', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'mzFdxy6kmDsGE4AQ6KYNMiwQWrnKCn6mNdhlL4JaCZLT4njQkybXRpVhRxNKVOfrY54qDvfxMIk39Kd1X7QfjzY6EZoTvVVlOyx9k',
        },
        body: JSON.stringify(milvusData),
      })
        .then(response => response.json())
        .then(milvusResponse => console.log('Resposta do Milvus:', milvusResponse))
        .catch(error => console.error('Erro ao enviar dados para Milvus:', error));
    }

function buscarEEnviarParaAPIs() {
  var billId = document.getElementById('billId').value;
  var urlSienge = 'https://api.sienge.com.br/ebm/public/api/v1/bills/' + billId;

  fetch(urlSienge)
    .then(response => {
      if (!response.ok) {
        throw new Error('Erro na chamada da API Sienge: ' + response.status);
      }
      return response.json();
    })
    .then(data => {
      console.log(data);
      enviarParaMilvus(data);
    })
    .catch(error => console.error('Erro na chamada da API Sienge:', error));
}

async function enviarParaMilvus(data) {
  try {
    // Configurar dados para a API do Milvus usando os dados recebidos do Sienge
    var dadosMilvus = {
      "cliente_id": "CL4RYB",
      "chamado_assunto": "verde",
      "chamado_descricao": JSON.stringify(data),
      // ... outras propriedades ...
    };

    // Configurar a chamada Ã  API do Milvus
    var urlMilvus = 'https://apiintegracao.milvus.com.br/api/chamado/criar';
    var tokenMilvus = 'mzFdxy6kmDsGE4AQ6KYNMiwQWrnKCn6mNdhlL4JaCZLT4njQkybXRpVhRxNKVOfrY54qDvfxMIk39Kd1X7QfjzY6EZoTvVVlOyx9k';

    const response = await fetch(urlMilvus, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': tokenMilvus,
      },
      body: JSON.stringify(dadosMilvus),
    });

    if (!response.ok) {
      throw new Error('Erro na chamada da API Milvus: ' + response.status);
    }

    const result = await response.json();
    console.log('Resposta da API Milvus:', result);
  } catch (error) {
    console.error('Erro na chamada da API Milvus:', error);
  }
}
.then(function(data) {
  exibirResultado(data);
  enviarParaMilvus(data);
})



  </script>

</body>
</html>
